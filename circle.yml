machine:
  node:
    version: 0.10.26
dependencies:
  cache_directories:
    - "vendor/bundle"
    - "node_modules"
  override:
    - npm install
    - ruby -e 'if ENV["CIRCLE_BRANCH"] =~ /(.*chef.*)|(master)/ then exec "bundle check --path=vendor/bundle || bundle install --path=vendor/bundle --clean" end':
        pwd: cookbook
        timeout: 99999
    - ruby -e 'if ENV["CIRCLE_BRANCH"] =~ /(.*chef.*)|(master)/ then exec "bundle exec berks install" end': 
        pwd: cookbook
test:
  override:
    - npm test
    - ruby -e 'if ENV["CIRCLE_BRANCH"] =~ /(.*chef.*)|(master)/ then exec "bundle exec rake test" end': 
        pwd: cookbook
        timeout: 99999
  post:
    - cp cookbook/.kitchen/logs/* $CIRCLE_ARTIFACTS